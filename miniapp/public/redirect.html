<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–∫—Ä—ã—Ç–∏–µ Happ...</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            padding: 20px;
        }
        .container { text-align: center; max-width: 400px; }
        .spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #00d9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        h2 { font-size: 20px; margin-bottom: 10px; }
        p { color: rgba(255,255,255,0.7); font-size: 14px; margin-bottom: 20px; }
        .btn {
            display: inline-block;
            padding: 14px 28px;
            background: #00d9ff;
            color: #000;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            border: none;
            cursor: pointer;
            margin: 5px;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .hidden { display: none; }
        .manual { margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
        .link-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            word-break: break-all;
            font-family: monospace;
            font-size: 11px;
            margin: 10px 0;
            max-height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading">
            <div class="spinner"></div>
            <h2>–û—Ç–∫—Ä—ã–≤–∞–µ–º Happ...</h2>
            <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å</p>
        </div>
        
        <div id="buttons">
            <a id="openBtn" class="btn" href="#">üì± –û—Ç–∫—Ä—ã—Ç—å –≤ Happ</a>
        </div>
        
        <div id="manual" class="manual hidden">
            <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Happ:</p>
            <div id="linkBox" class="link-box"></div>
            <button id="copyBtn" class="btn btn-secondary">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const redirectUrl = params.get('redirect');  // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ (happ://crypt4/...)
        const originalUrl = params.get('original');  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω—Å–æ–ª—å
        console.log('Encrypted URL:', redirectUrl);
        console.log('Original URL:', originalUrl);
        console.log('Full page URL:', window.location.href);
        
        if (redirectUrl) {
            const openBtn = document.getElementById('openBtn');
            const linkBox = document.getElementById('linkBox');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
            openBtn.href = redirectUrl;
            
            // –î–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É (–±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è)
            linkBox.textContent = originalUrl || redirectUrl;
            
            // –ú–µ—Ç–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º iframe –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
            try {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = redirectUrl;
                document.body.appendChild(iframe);
            } catch(e) { console.log('Iframe error:', e); }
            
            // –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø—Ä–æ–±—É–µ–º location.href
            setTimeout(function() {
                try {
                    window.location.href = redirectUrl;
                } catch(e) { console.log('Location.href error:', e); }
            }, 100);
            
            // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª —Å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ—à–ª–∏
            setTimeout(function() {
                document.getElementById('loading').querySelector('.spinner').style.display = 'none';
                document.getElementById('loading').querySelector('h2').textContent = '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ';
                document.getElementById('manual').classList.remove('hidden');
            }, 2000);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è - –∫–æ–ø–∏—Ä—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
            document.getElementById('copyBtn').addEventListener('click', function() {
                const urlToCopy = originalUrl || redirectUrl;
                
                // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(urlToCopy).then(() => {
                        this.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                        setTimeout(() => { this.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É'; }, 2000);
                    }).catch(() => {
                        fallbackCopy(urlToCopy, this);
                    });
                } else {
                    fallbackCopy(urlToCopy, this);
                }
            });
            
            function fallbackCopy(text, btn) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.left = '-9999px';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                setTimeout(() => { btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É'; }, 2000);
            }
        } else {
            document.getElementById('loading').innerHTML = '<h2>–û—à–∏–±–∫–∞</h2><p>–°—Å—ã–ª–∫–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>';
            document.getElementById('buttons').style.display = 'none';
        }
    </script>
</body>
</html>
